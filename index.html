---
layout: default
---

<div class="home">

  <h1 class="page-heading">Recent builds</h1>
  <div>
    <ul class="nav nav-tabs" role="tablist">
    {% assign summaries = site.data.build_summary.aggregations %}
    {% assign errors_summaries = site.data.errors.aggregations %}

    {% for product in summaries.by_package.buckets %}
      {% assign product_name = product.key %}
      <li role="presentation" {% if forloop.first == true %}class="active"{%endif%}>
        <a href="#{{product_name}}" aria-controls="{{product_name}}" role="tab" data-toggle="tab">{{ product_name }}</a>
      </li>
    {% endfor %}
    </ul>
      
    <div class="tab-content">
    {% for product in summaries.by_package.buckets %}
      {% assign product_name = product.key %}
      {%capture commit_file %}commits-{{product_name}}-master{%endcapture%}
      <div role="tabpanel" class="tab-pane {% if forloop.first == true %}active{%endif%}" id="{{product_name}}">
        {% assign commits = site.data[commit_file] %}
        <div class="list-group">
        {% for commit_info in commits %}
          {% capture commit %}{{commit_info.commit | truncate: 11}}{%endcapture%}
          {% if forloop.first %}
           <div class="list-group-item">
              <h4 class="list-group-item-heading">Not tested yet</h4>
          {% endif %}
          {% for builds_by_commit in product.by_commit.buckets %}
            {% capture build_commit %}{{builds_by_commit.key}}...{%endcapture%}
            {% if build_commit == commit %}
              </div>
              <div href="#" class="list-group-item">
                <h4 class="list-group-item-heading">{{builds_by_commit.key}} ({{commit_info.author}}): {{commit_info.message}} </h4>
                <p class="list-group-item-text">
                  <ul>
                    {% for build in builds_by_commit.build_id.buckets %}
                      {% assign build_nr = build.key %}
                      {% assign architecture = build.architecture.buckets[0].key %}
                      {% assign alidist_repo = build.architecture.buckets[0].alidist_repo.buckets[0].key %}
                      <li><a href="http://alijenkins.cern.ch/job/build-any-ib/{{build_nr}}/console">Build #{{ build_nr }}</a> ({{architecture}}) using <a href="https://github.com/{{alidist_repo}}/alidist">{{alidist_repo}}/alidist</a></li>
                      {% for error_build in errors_summaries.by_build.buckets %}
                        {% if build_nr == error_build.key %}
                          Errors:
                          {% for message in error_build.by_message.buckets %}
                            <br/>{{message.key}}<br/>
                            <table class="table table-condensed" style="table-layout: fixed;">
                            <thead>
                              <tr><th style="width: 90%;">Filename</th><th>Line</th></tr>
                            </thead>
                            <tbody>
                              {% for filename in message.filename.buckets %}
                              <tr>
                                <td style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align:right;">
                                    {{filename.key }}
                                </td>
                                <td style="width: 10%;">{{filename.line.buckets[0].key}}</td>
                              </tr>
                              {% endfor %}
                            </tbody>
                            </table>
                          {% endfor %}
                        {% endif %}
                      {% endfor %}
                    {% endfor %}
                  </ul>
                </p>
            {% endif %}
          {% endfor  %}
          <br>{{ commit }} ({{commit_info.author}}): {{commit_info.message }}
          {% if forloop.last%}
           </div>
          {% endif %}
        {% endfor %}
        </div>
      </div>
    {% endfor %}
    </div>
  </div>
</div>
